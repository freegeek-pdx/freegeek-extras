#!/bin/sh

set -e

if [ "$(id -u)" != "0" ]; then
   echo "Error: $0 must be ran as root"
   exit 1
fi

alert() {
  if test -n "$DISPLAY"; then
    zenity --error --text="$@"
  else
    echo "ERROR: $@"
  fi
}

success() {
  if test -n "$DISPLAY"; then
    zenity --info --text="$@"
  else
    echo "SUCCESS: $@"
  fi  
}

echo "================================================="
echo "=    RESTRICTED EXTRAS WILL NOW BE INSTALLED.   ="
echo "= PLEASE ALLOW THE INSTALLATION TO COMPLETE AND ="
echo "=      FOLLOW ANY FURTHER INSTRUCTION GIVEN     ="
echo "================================================="
echo ""

trap 'echo "======================="; echo "= INSTALLATION FAILED ="; echo "======================="; alert "Installation of restricted extras failed.";' EXIT

# set up xubuntu-restricted-extras
sed -i.bak '/multiverse/ !s/main restricted/main restricted multiverse/g' /etc/apt/sources.list
apt-get update
if [ ! -e /usr/share/package-data-downloads/ttf-mscorefonts-installer ]; then
    REMOVEPKG=ttf-mscorefonts-installer-
else
    REMOVEPKG=""
fi
aptitude install -y xubuntu-restricted-extras vlc $REMOVEPKG
# verify successful installation
dpkg-query --show xubuntu-restricted-extras >/dev/null
# install libdvdcss
/usr/share/doc/libdvdread4/install-css.sh

echo "=========================="
echo "= INSTALLATION SUCCEEDED ="
echo "=========================="
success "Restricted packages were successfully installed, you should now be able to use DVDs, Flash player, etc."
trap - EXIT
